import{G as oe,q as D,h as C,p as H,o as e,k as z,_ as k,t as ie,i as se,l as le,B as de}from"./preact-23a6e7b2.js";import{L as ce,B as pe}from"./react-router-dom-6a232c9b.js";import{a as p,F as l,I as v,D as me,S as E,A as ue,B as y,b as U,P as Y,c as he,d as ge,e as V,f as ye,z as fe,C as be}from"./antd-743c3251.js";import{d as x}from"./dayjs-8d9e1f51.js";import{a as Te}from"./axios-3a76d256.js";import{C as h}from"./crypto-js-49de59d4.js";import{a as we,O as ve,d as xe,e as S}from"./react-router-5297406e.js";import{Z as De,m as Pe,c as Ue,u as Ae}from"./@wangeditor-555b4898.js";import{u as M,a as ke,b as j}from"./ahooks-49e0bcf3.js";import"./@remix-run-671dfa1a.js";import"./@ant-design-618bfa90.js";import"./rc-util-f8219cd0.js";import"./react-is-e5978b8b.js";import"./@babel-179c1243.js";import"./@emotion-c0b5c018.js";import"./stylis-fad5b415.js";import"./classnames-b6baddbd.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./@ctrl-fb5a5473.js";import"./rc-resize-observer-34f97b1d.js";import"./rc-motion-746079e2.js";import"./rc-select-194ce3ad.js";import"./rc-overflow-0bb9126a.js";import"./@rc-component-ae1e168c.js";import"./rc-virtual-list-6db7f7af.js";import"./rc-picker-26263728.js";import"./rc-menu-ae608012.js";import"./rc-input-bcebddf2.js";import"./rc-textarea-b691a614.js";import"./rc-drawer-bc94d156.js";import"./rc-dropdown-d049dd0c.js";import"./rc-field-form-7389636d.js";import"./async-validator-dee29e8b.js";import"./throttle-debounce-87e7e444.js";import"./rc-notification-03b87e2a.js";import"./rc-pagination-acfb58ea.js";import"./rc-tooltip-aaf6aa9e.js";import"./tslib-8b218df4.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const _={loading:!1,list:[],tags:[]},Ee=(a,t)=>{switch(t.type){case"UPDATE":return{...a,...t.payload||{}};default:return a}},w=oe({state:_,dispatch:()=>{}});p.config({top:100,duration:3,maxCount:1});const R=localStorage.getItem("baseURL"),Ce=R||"https://ndzy-server.vercel.app",u=Te.create({baseURL:Ce,timeout:6e4,withCredentials:!1});u.interceptors.request.use(a=>{const t=localStorage.getItem("token");return t&&(a.headers={Authorization:"Basic "+t}),a},a=>{Promise.reject(a)});u.interceptors.response.use(a=>{const t=a.data;return a.data.status===1&&p.error(a.data.msg),a.data.status===0&&p.success(a.data.msg),a.data.status===2&&localStorage.setItem("token",""),t},a=>{let t="";if(a&&a.response)switch(a.response.status){case 302:t="接口重定向了！",p.error(t);break;case 400:t="参数不正确！",p.error(t);break;case 401:t="您未登录，或者登录已经超时，请先登录！",p.error(t);break;case 403:t="您没有权限操作！",p.error(t);break;case 404:t=`请求地址出错: ${a.response.config.url}`,p.error(t);break;case 408:t="请求超时！",p.error(t);break;case 409:t="系统已存在相同数据！",p.error(t);break;case 500:t="服务器内部错误！",p.error(t);break;case 501:t="服务未实现！",p.error(t);break;case 502:t="网关错误！",p.error(t);break;case 503:t="服务不可用！",p.error(t);break;case 504:t="服务暂时无法访问，请稍后再试！",p.error(t);break;case 505:t="HTTP 版本不受支持！",p.error(t);break;default:t="异常问题，请联系管理员！",p.error(t);break}return Promise.reject(t)});const Ie=a=>a&&a<x().endOf("day"),K=()=>{let a=new Date().getTime();return typeof performance<"u"&&typeof performance.now=="function"&&(a+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const o=(a+Math.random()*16)%16|0;return a=Math.floor(a/16),(n=="x"?o:o&3|8).toString(16)})},q=()=>{let a="";for(let t=0;t<8;t++)a+=K().replace(/-/g,"");return a},Ne=(a,t,n)=>{const o=h.enc.Utf8.parse(t),i=h.enc.Utf8.parse(n),r=h.enc.Hex.parse(a),d=h.enc.Base64.stringify(r);return h.AES.decrypt(d,o,{iv:i,mode:h.mode.CBC,padding:h.pad.Pkcs7,hasher:h.algo.SHA256}).toString(h.enc.Utf8).toString()},O=a=>{const t=q(),n=q(),o=h.enc.Utf8.parse(t),i=h.enc.Utf8.parse(n),r=h.enc.Utf8.parse(a),d=h.AES.encrypt(r,o,{iv:i,mode:h.mode.CBC,padding:h.pad.Pkcs7,hasher:h.algo.SHA256});return{keyBase:t,ivBase:n,text:d.ciphertext.toString().toUpperCase()}},B={labelCol:{xs:{span:6},sm:{span:6}},wrapperCol:{xs:{span:18},sm:{span:18}}},F={wrapperCol:{span:14,offset:2}},A=()=>{const a=we(),{dispatch:t}=D(w),[n,o]=C(""),[i,r]=C([]),d=(s,m={})=>{a(s,{...m})},g=()=>{t({type:"UPDATE",payload:{loading:!0}}),u.get("/users").then(s=>{t({type:"UPDATE",payload:{user:s.data,loading:!1}})}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},c=()=>{t({type:"UPDATE",payload:{loading:!0}}),u("/tags").then(s=>{t({type:"UPDATE",payload:{tags:s.data,loading:!1}})}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},b=(s={})=>{t({type:"UPDATE",payload:{loading:!0}}),u.get("/todos",{params:{...s}}).then(m=>{t({type:"UPDATE",payload:{list:m.data.map(T=>({...T,detail:Ne(T.detail,T.keyBase,T.ivBase)})),loading:!1}})}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},f=(s,m)=>{t({type:"UPDATE",payload:{loading:!0}});const{text:T,keyBase:I,ivBase:N}=O(s.detail);u.post("/todos",{...s,operationSource:"h5",detail:T,keyBase:I,ivBase:N}).then(()=>{t({type:"UPDATE",payload:{loading:!1}}),b(),m&&m()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},G=(s,m,T)=>{t({type:"UPDATE",payload:{loading:!0}});const{text:I,keyBase:N,ivBase:ne}=O(s.detail);u.patch(`/todos/${m.id}`,{name:s.name,detail:I,keyBase:N,ivBase:ne,link:s.link,deadline:x(s.deadline).format("YYYY-MM-DD"),tagId:s.tagId}).then(()=>{t({type:"UPDATE",payload:{loading:!1}}),b(),T&&T()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},J=s=>{t({type:"UPDATE",payload:{loading:!0}}),u.patch(`/todos/${s.id}`,{isFinish:!0}).then(()=>{b()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},W=s=>{t({type:"UPDATE",payload:{loading:!0}}),u.delete(`/todos/${s.id}`).then(()=>{b()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},Q=s=>{t({type:"UPDATE",payload:{loading:!0}}),u.patch(`/todos/${s.id}`,{isFinish:!1}).then(()=>{b()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},X=()=>{localStorage.setItem("token",""),d("/"),window.location.reload()},ee=s=>{t({type:"UPDATE",payload:{loading:!0}}),u.post("/users/login",{...s}).then(m=>{t({type:"UPDATE",payload:{loading:!1}}),m&&m.data&&m.data.token&&(localStorage.setItem("token",m.data.token),d("/"),window.location.reload())}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},te=(s,m)=>{t({type:"UPDATE",payload:{loading:!0}}),u.post("/users/register",{...s}).then(T=>{t({type:"UPDATE",payload:{loading:!1}}),T.status===0&&m&&m()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},ae=s=>{t({type:"UPDATE",payload:{loading:!0}}),u.delete(`/tags/${s}`).then(()=>{c()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})},re=()=>{n&&(t({type:"UPDATE",payload:{loading:!0}}),u.post("/tags",{name:n}).then(()=>{o(""),c()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})}))},L=async()=>{t({type:"UPDATE",payload:{loading:!0}}),g(),u.get("/users/all").then(s=>{t({type:"UPDATE",payload:{loading:!1}}),r(s.data)}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})};return{inputValue:n,users:i,initUser:g,initTags:c,createTodo:f,editTodo:G,goPage:d,getAllTodo:b,finishTodo:J,delTodo:W,recoverTodo:Q,signOut:X,login:ee,register:te,delTag:ae,handleCreateTag:re,setInputValue:o,getUsers:L,delUser:s=>{t({type:"UPDATE",payload:{loading:!0}}),u.delete(`/users/${s.id}`).then(()=>{L()}).catch(()=>{t({type:"UPDATE",payload:{loading:!1}})})}}};De.registerModule(Pe);function Se({value:a,onChange:t}){const[n,o]=C(null),[i,r]=C("");H(()=>{r(a)},[a]);const d={},g={placeholder:"请输入内容..."};return H(()=>()=>{n!=null&&(n.destroy(),o(null))},[n]),e(z,{children:e("div",{style:{border:"1px solid #ccc",zIndex:100},children:[e(Ue,{editor:n,defaultConfig:d,mode:"default",style:{borderBottom:"1px solid #ccc"}}),e(Ae,{defaultConfig:g,value:i,onCreated:o,onChange:c=>{r(c.getHtml()),t(c.getHtml())},mode:"default",style:{overflowY:"hidden",minHeight:330}})]})})}const Z=a=>{const{createTodo:t,editTodo:n}=A(),{state:o}=D(w),i=r=>a.id?n(r,{id:a.id},a.onClose):t(r,a.onClose);return e(l,{initialValues:{name:a.name,deadline:a.deadline?x(a.deadline):x(),detail:a.detail,tagId:a.tagId},preserve:!1,name:"edit",onFinish:i,scrollToFirstError:!0,children:[e(l.Item,{name:"name",label:"名称",rules:[{required:!0,message:"名称不能为空"}],children:e(v.TextArea,{rows:1})}),e(l.Item,{name:"deadline",label:"终止时间",rules:[{required:!0,message:"终止时间不能为空"}],children:e(me,{className:"w-100",format:"YYYY-MM-DD",disabledDate:Ie})}),e(l.Item,{name:"detail",label:"详情",rules:[{required:!0,message:"详情不能为空"}],children:e(Se,{})}),e(l.Item,{name:"tagId",label:"标签",rules:[{required:!0,message:"请选择一个标签"}],children:e(E,{options:o.tags.map(r=>({label:`${r.name}-(${r.userName})`,value:r.id}))})}),e(l.Item,{children:e(ue,{offsetBottom:16,children:e(y,{loading:o.loading,type:"primary",htmlType:"submit",children:a.id?"保存":"创建"})})})]})},Ye=()=>{const a=k(null),t=k(null),{inputValue:n,delTag:o,handleCreateTag:i,setInputValue:r}=A(),{state:d}=D(w),[g]=M(d.tags,{containerTarget:a,wrapperTarget:t,itemHeight:60,overscan:10});return e("div",{children:[e(U.Compact,{className:"w-100",children:[e(v,{placeholder:"请输入",value:n,onChange:c=>r(c.target.value)}),e(y,{loading:d.loading,type:"primary",onClick:i,children:"添加"})]}),e("div",{ref:a,style:{height:window.innerHeight/2,overflow:"auto",marginTop:16},children:e("div",{ref:t,children:g.map(c=>{var b;return e("div",{style:{height:52,display:"flex",justifyContent:"center",alignItems:"center",border:"1px solid #e8e8e8",marginBottom:8},children:e("div",{className:"between w-100",children:[e("div",{className:"between",children:[c.data.name,((b=d.user)==null?void 0:b.role)==="0"&&e(Y,{title:"删除将无法恢复,确定删除?",onConfirm:()=>o(c.data.id),children:e(y,{children:" 删除"})})]}),e("div",{children:e(U,{children:e("span",{children:["创建人：",c.data.userName||"--"]})})})]})},c.data.id)})})})]})},Me=({children:a,...t})=>ie(a)?se(a,{...t}):a,P=({title:a,btnName:t,children:n,...o})=>{const[i,r]=ke({open:!1});return e(z,{children:[e(y,{type:"link",onClick:()=>r({open:!0}),children:t}),e(he,{destroyOnClose:!0,open:i.open,title:a,placement:"right",width:"100%",onClose:()=>r({open:!1}),children:e(Me,{onClose:()=>r({open:!1}),...o,children:i&&n})})]})},Be=()=>{const{login:a}=A(),{state:t}=D(w);return e(l,{...B,name:"login",onFinish:a,scrollToFirstError:!0,children:[e(l.Item,{name:"mobile",label:"手机号",rules:[{required:!0,message:"请输入你的手机号!"}],children:e(v,{className:"w-100"})}),e(l.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码!"}],hasFeedback:!0,children:e(v.Password,{})}),e(l.Item,{...F,children:e(y,{loading:t.loading,type:"primary",htmlType:"submit",children:"登录"})})]})},Fe=({onClose:a})=>{const{register:t}=A(),{state:n}=D(w);return e(l,{...B,name:"register",onFinish:o=>t(o,a),scrollToFirstError:!0,children:[e(l.Item,{name:"nickname",label:"昵称",rules:[{required:!0,message:"请输入你的昵称!",whitespace:!0}],children:e(v,{})}),e(l.Item,{name:"mobile",label:"手机号",rules:[{required:!0,message:"请输入你的手机号!"}],children:e(v,{className:"w-100"})}),e(l.Item,{name:"password",label:"密码",rules:[{required:!0,message:"请输入密码!"}],hasFeedback:!0,children:e(v.Password,{})}),e(l.Item,{name:"confirm",label:"确认密码",dependencies:["password"],hasFeedback:!0,rules:[{required:!0,message:"请再次输入密码!"},({getFieldValue:o})=>({validator(i,r){return!r||o("password")===r?Promise.resolve():Promise.reject(new Error("两次密码不匹配!"))}})],children:e(v.Password,{})}),e(l.Item,{...F,children:e(y,{loading:n.loading,type:"primary",htmlType:"submit",children:"注册"})})]})},Le=()=>{const a=k(null),t=k(null),{users:n,delUser:o,getUsers:i}=A(),{state:r}=D(w),[d]=M(n,{containerTarget:a,wrapperTarget:t,itemHeight:60,overscan:10});return j(()=>{i()}),e("div",{ref:a,style:{height:window.innerHeight/2,overflow:"auto"},children:e("div",{ref:t,children:d.map(g=>{var c;return e("div",{style:{height:52,display:"flex",justifyContent:"center",alignItems:"center",border:"1px solid #e8e8e8",marginBottom:8},children:e("div",{className:"between w-100",children:[e("div",{className:"between",children:["用户名：",g.data.nickname,((c=r.user)==null?void 0:c.role)==="0"&&e(Y,{title:"删除将无法恢复,确定删除?",onConfirm:()=>o(g.data),children:e(y,{children:" 删除"})})]}),e("div",{children:e(U,{children:[e("span",{children:["创建日期：",x(g.data.createdAt).subtract(8,"h").format("YYYY-MM-DD")]}),e("span",{children:["更新日期：",x(g.data.updatedAt).subtract(8,"h").format("YYYY-MM-DD")]})]})})]})},g.data.id)})})})},He=({onClose:a})=>{const{getAllTodo:t}=A(),{state:n}=D(w);return e(l,{initialValues:{operationSource:"h5",isFinish:"0"},...B,name:"search",onFinish:o=>{t(o),a()},scrollToFirstError:!0,children:[e(l.Item,{name:"name",label:"名称",children:e(v,{className:"w-100"})}),e(l.Item,{name:"tagId",label:"标签",children:e(E,{className:"w-100",options:n.tags.map(o=>({label:`${o.name}-(${o.userName})`,value:o.id}))})}),e(l.Item,{name:"operationSource",label:"来源",children:e(E,{className:"w-100",options:[{label:"h5",value:"h5"},{label:"微信",value:"wx"}]})}),e(l.Item,{name:"isFinish",label:"状态",children:e(E,{className:"w-100",options:[{label:"进行中",value:"0"},{label:"已完成",value:"1"}]})}),e(l.Item,{...F,children:e(y,{loading:n.loading,type:"primary",htmlType:"submit",children:"搜索"})})]})},{Header:Re,Content:qe}=V,Oe=()=>{const{signOut:a,getAllTodo:t}=A(),{state:n}=D(w),o=[{key:"1",label:e(P,{title:"登陆",btnName:"登陆",children:e(Be,{})})},{key:"2",label:e(P,{title:"注册",btnName:"注册",children:e(Fe,{})})},{key:"3",label:n.user&&n.user.role==="0"&&e(P,{title:"用户管理",btnName:"用户管理",children:e(Le,{})})},{key:"4",label:e(y,{type:"link",onClick:a,children:"登出"})}];return e(V,{className:"ndzy-layout",children:[e(Re,{className:"ndzy-header",children:e(U,{className:"mb-16",children:[n.user&&e("div",{style:{minWidth:33},className:"sky-blue center",children:n.user.name||n.user.nickname}),e(P,{title:"新建",btnName:"新建",children:e(Z,{})}),e(P,{title:"标签",btnName:"标签",children:e(Ye,{})}),e(P,{title:"搜索",btnName:"搜索",children:e(He,{})}),e(y,{type:"link",onClick:()=>t(),children:"重置"}),e(ge,{menu:{items:o},children:e("a",{onClick:i=>i.preventDefault(),children:"其他"})})]})}),e(qe,{children:e("div",{className:"layout-content p-16",children:e(ve,{})})})]})},$e=({value:a})=>{const t=K();return e("div",{style:{padding:"0 8px"},id:`preview-${t}`,className:"ndzy-preview",dangerouslySetInnerHTML:{__html:a}})},$=a=>e(P,{title:"查看",btnName:"查看",children:[e($e,{value:a.detail}),e("div",{children:e(U,{children:[e("span",{style:{color:"blue"},children:["创建人：",a.userName||"--"]}),e("span",{style:{color:"green"},children:["标签：",a.tagName||"--"]}),e("span",{style:{color:"red"},children:["终止日期：",x(a.deadline).format("YYYY-MM-DD")]})]})}),e("div",{children:e(U,{children:[e("span",{children:["创建日期：",x(a.createdAt).subtract(8,"h").format("YYYY-MM-DD")]}),e("span",{children:["更新日期：",x(a.updatedAt).subtract(8,"h").format("YYYY-MM-DD")]})]})})]}),ze=()=>{const{state:a}=D(w),t=k(null),n=k(null),[o]=M(a.list,{containerTarget:t,wrapperTarget:n,itemHeight:60,overscan:10}),{initUser:i,initTags:r,getAllTodo:d,finishTodo:g,delTodo:c,recoverTodo:b}=A();return j(()=>{i(),r(),d()}),e("div",{children:[e("div",{className:"center",children:a.loading&&e(ye,{})}),o.length===0&&e("div",{className:"center",children:"暂无待办事项"}),e("div",{ref:t,style:{height:window.innerHeight*.8,overflow:"auto"},children:e("div",{ref:n,children:o.map(f=>e("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",border:"1px solid #e8e8e8",marginBottom:8},children:e("div",{className:"between w-100 todo-item",children:[e("div",{children:f.data.name}),e("div",{children:Number(f.data.isFinish)===0?e(U,{children:[e($,{...f.data}),e("span",{style:{color:"red"},children:"处理中"}),e(P,{title:"编辑",btnName:"编辑",...f.data,children:e(Z,{})}),e(y,{type:"link",onClick:()=>g(f.data),children:"完成"})]}):Number(f.data.isFinish)===1?e(U,{children:[e($,{...f.data}),e("span",{style:{color:"green"},children:"已完成"}),e(y,{type:"link",onClick:()=>b(f.data),children:"恢复"}),e(Y,{title:"删除将无法恢复,确定删除?",onConfirm:()=>c(f.data),children:e(y,{type:"link",children:" 删除"})})]}):null})]})},f.data.id))})})]})},Ve=()=>e("div",{className:"center",children:e("div",{children:[e("h2",{children:"页面不存在"}),e("p",{children:e(ce,{to:"/",children:"返回首页"})})]})}),je=()=>{const[a,t]=le(Ee,_);return e(be,{locale:fe,children:e(w.Provider,{value:{state:a,dispatch:t},children:e(xe,{children:e(S,{path:"/",element:e(Oe,{}),children:[e(S,{index:!0,element:e(ze,{})}),e(S,{path:"*",element:e(Ve,{})})]})})})})};de(e(pe,{children:e(je,{})}),document.getElementById("app"));
